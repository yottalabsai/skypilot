{
    "sourceFile": "YOTTA_INTEGRATION.md",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1768469270446,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1768469270445,
            "name": "Commit-0",
            "content": "# Yotta æ¥å…¥ SkyPilot å®ç°æ–¹æ¡ˆ\n\n## ğŸ“‹ é¡¹ç›®æ¦‚è§ˆ\n\nå½“å‰é¡¹ç›®æ˜¯ SkyPilot çš„ forkï¼Œç”¨äºå¼€å‘ Yotta äº‘æä¾›å•†é›†æˆã€‚Yotta åŸºäº Kubernetes pods ä½œä¸ºåº•å±‚åŸºç¡€è®¾æ–½ã€‚\n\n**çŠ¶æ€**: âœ… 85%å®Œæˆ - æ ¸å¿ƒåŠŸèƒ½å·²å®ç°ï¼Œç¼ºå°‘catalogæ•°æ®\n\n---\n\n## ğŸ—ï¸ æ¶æ„è®¾è®¡\n\n### SkyPilot äº‘æä¾›å•†ä¸‰å±‚æ¶æ„\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ 1. Cloud Interface Layer            â”‚\nâ”‚    sky/clouds/yotta.py              â”‚ â† èµ„æºå®šä¹‰ã€å®šä»·ã€åŒºåŸŸ\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ 2. Provisioner Layer                â”‚\nâ”‚    sky/provision/yotta/             â”‚ â† VM/Pod ç”Ÿå‘½å‘¨æœŸç®¡ç†\nâ”‚    â”œâ”€â”€ instance.py                   â”‚\nâ”‚    â”œâ”€â”€ yotta_utils.py (API Client)  â”‚\nâ”‚    â””â”€â”€ config.py                     â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ 3. Template Layer                   â”‚\nâ”‚    sky/templates/yotta-ray.yml.j2   â”‚ â† Ray é›†ç¾¤é…ç½®\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Yotta æ¶æ„ç‰¹ç‚¹\n\n- **åº•å±‚**: Kubernetes pods (ç±»ä¼¼ SkyPilot çš„ K8s cloud)\n- **Provisioner ç‰ˆæœ¬**: SKYPILOT (v3, æœ€æ–°ç‰ˆ)\n- **API Endpoint**: `https://api.dev.yottalabs.ai/sdk/api`\n- **è®¤è¯**: `~/.yotta/credentials` (userId + apikey)\n\n---\n\n## ğŸ“‚ å·²å®ç°çš„ç»„ä»¶\n\n### âœ… 1. Cloud Provider (`sky/clouds/yotta.py` - 305è¡Œ)\n\n**æ³¨å†Œåˆ°ç³»ç»Ÿ**:\n```python\n@registry.CLOUD_REGISTRY.register\nclass Yotta(clouds.Cloud):\n    _REPR = 'Yotta'\n    PROVISIONER_VERSION = clouds.ProvisionerVersion.SKYPILOT\n```\n\n**ä¸æ”¯æŒçš„ç‰¹æ€§**:\n- âŒ STOP (æ— æ³•åœæ­¢å®ä¾‹)\n- âŒ CUSTOM_DISK_TIER\n- âŒ STORAGE_MOUNTING (ä½¿ç”¨ COPY æ¨¡å¼)\n- âŒ MULTI_NODE (å¾…ç¡®è®¤ Yotta API æ˜¯å¦æ”¯æŒ)\n\n**å®ä¾‹ç±»å‹** (æ¥è‡ª `yotta_utils.py`):\n```python\nGPU_NAME_MAP = {\n    '1x_A10_SECURE': 'NVIDIA_A10_24G',\n    '1x_L4_SECURE': 'NVIDIA_L4_24G',\n    '2x_L4_SECURE': 'NVIDIA_L4_24G',\n}\n```\n\n### âœ… 2. Provisioner (`sky/provision/yotta/`)\n\n**æ–‡ä»¶ç»“æ„**:\n```\nyotta/\nâ”œâ”€â”€ __init__.py          # æ¨¡å—å¯¼å‡º\nâ”œâ”€â”€ config.py            # Bootstrap é…ç½®\nâ”œâ”€â”€ instance.py          # å®ä¾‹ç”Ÿå‘½å‘¨æœŸ (280è¡Œ)\nâ””â”€â”€ yotta_utils.py       # API å®¢æˆ·ç«¯ (302è¡Œ)\n```\n\n**API å®¢æˆ·ç«¯åŠŸèƒ½** (`YottaClient`):\n```python\ncheck_api_key()              # éªŒè¯å‡­è¯\nget_pod_by_labels()          # æŸ¥è¯¢é›†ç¾¤å®ä¾‹\nlaunch()                     # åˆ›å»ºæ–° pods\ndestroy_pods()               # é”€æ¯ pods\nget_or_add_ssh_key()         # SSHå¯†é’¥ç®¡ç†\n```\n\n**Pod çŠ¶æ€æ˜ å°„**:\n```\nYotta PodStatus          â†’ SkyPilot ClusterStatus\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nINITIALIZE (0)           â†’ INIT\nRUNNING (1)              â†’ UP\nPAUSING (2)              â†’ UP\nPAUSED (3)               â†’ STOPPED\nTERMINATING (4)          â†’ UP\nTERMINATED (5)           â†’ STOPPED\nFAILED (6)               â†’ STOPPED\n```\n\n### âœ… 3. è®¤è¯ç³»ç»Ÿ (`sky/authentication.py`)\n\n**é›†æˆç‚¹** (Line 598-610):\n```python\ndef setup_yotta_authentication(config: Dict[str, Any]) -> Dict[str, Any]:\n    \"\"\"Sets up SSH authentication for Yotta.\n    - Generates SSH key pair if not exists\n    - Adds public key to Yotta account\n    \"\"\"\n    _, public_key_path = get_or_generate_keys()\n    with open(public_key_path, 'r', encoding='UTF-8') as pub_key_file:\n        public_key = pub_key_file.read().strip()\n        yotta_client.get_or_add_ssh_key(public_key)\n    \n    config['auth']['ssh_public_key'] = public_key_path\n    return configure_ssh_info(config)\n```\n\n**è®¤è¯æµç¨‹**:\n```\nUser: sky launch\n    â†“\nbackend_utils.write_cluster_config()\n    â†“\nauth.setup_yotta_authentication()\n    â†“\nyotta_client.get_or_add_ssh_key()\n    â†“\nAPI: POST /compute/create/publicKey\n```\n\n### âœ… 4. Catalog æ¨¡å— (`sky/catalog/yotta_catalog.py`)\n\nå·²å®ç°æ‰€æœ‰å¿…éœ€å‡½æ•°ï¼š\n- `instance_type_exists()`\n- `validate_region_zone()`\n- `get_hourly_cost()`\n- `get_vcpus_mem_from_instance_type()`\n- `get_default_instance_type()`\n- ç­‰ç­‰...\n\n### âœ… 5. Ray æ¨¡æ¿ (`sky/templates/yotta-ray.yml.j2` - 102è¡Œ)\n\n```yaml\nprovider:\n  type: external\n  module: sky.provision.yotta\n  region: \"{{region}}\"\n  availability_zone: \"{{availability_zone}}\"\n  disable_launch_config_check: true\n\nauth:\n  ssh_user: ubuntu\n```\n\n---\n\n## âš ï¸ ç¼ºå¤±çš„ç»„ä»¶\n\n### 1. Catalog æ•°æ®æ–‡ä»¶ âœ… å·²åˆ›å»º\n\n**ä½ç½®**: `~/.sky/catalogs/v7/yotta/vms.csv`\n\n**æ ¼å¼** (åŸºäº RunPod):\n```csv\nInstanceType,AcceleratorName,AcceleratorCount,vCPUs,MemoryGiB,GpuInfo,Region,SpotPrice,Price,AvailabilityZone\n1x_A10_SECURE,A10,1.0,32.0,128.0,A10:24GB,us-central1,,,us-central1-a\n1x_L4_SECURE,L4,1.0,16.0,64.0,L4:24GB,us-central1,,,us-central1-a\n2x_L4_SECURE,L4,2.0,32.0,128.0,L4:24GB,us-central1,,,us-central1-a\n```\n\n**æ³¨æ„**: \n- SpotPrice å’Œ Price ç•™ç©ºï¼ˆYotta ä¸æ”¯æŒ spotï¼‰\n- éœ€è¦ä» Yotta API æˆ–é…ç½®æ–‡ä»¶è·å–çœŸå®æ•°æ®\n\n### 2. Data Fetcher (å¯é€‰)\n\n**ä½ç½®**: `sky/catalog/data_fetchers/fetch_yotta.py`\n\n**ç”¨é€”**: è‡ªåŠ¨ä» Yotta API è·å–å¹¶æ›´æ–° catalog æ•°æ®\n\n**å‚è€ƒ**: `fetch_runpod.py`, `fetch_lambda.py`\n\n### 3. setup.py ä¾èµ–\n\n**éœ€è¦æ·»åŠ **:\n```python\nextras_require = {\n    ...\n    'yotta': ['requests'],  # Yotta API æ‰€éœ€\n    ...\n}\n```\n\n---\n\n## ğŸ”§ å¼€å‘ç¯å¢ƒè®¾ç½®\n\n### ä¸ºä»€ä¹ˆéœ€è¦éš”ç¦»ç¯å¢ƒï¼Ÿ\n\nä½œä¸ºcontributorï¼Œä½ å½“å‰ `~/.sky` ç›®å½•æ˜¯ç”±ç³»ç»Ÿå®‰è£…çš„ SkyPilot åˆ›å»ºçš„ã€‚ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒçš„å¥½å¤„ï¼š\n\nâœ… **å¼€å‘ç¯å¢ƒéš”ç¦»**: ä»£ç ä¿®æ”¹ç«‹å³ç”Ÿæ•ˆï¼Œä¸å½±å“ç³»ç»Ÿç‰ˆæœ¬  \nâœ… **editable install**: `pip install -e .` ä½¿ä¿®æ”¹æ— éœ€é‡æ–°å®‰è£…  \nâœ… **ç‹¬ç«‹é…ç½®**: å¯ä»¥ä½¿ç”¨ç‹¬ç«‹çš„ SkyPilot é…ç½®  \nâœ… **æ— å†²çªæµ‹è¯•**: æµ‹è¯• Yotta ä¸ä¼šç ´åç°æœ‰ç¯å¢ƒ\n\n### ç¯å¢ƒå·²åˆ›å»º âœ…\n\n```bash\n# 1. è™šæ‹Ÿç¯å¢ƒå·²åˆ›å»ºå¹¶å®‰è£…\nvenv-dev/  # å¼€å‘ä¸“ç”¨è™šæ‹Ÿç¯å¢ƒ\n\n# 2. å¯åŠ¨å¼€å‘ç¯å¢ƒ\n./start-dev.sh  # è‡ªåŠ¨æ¿€æ´»ç¯å¢ƒå¹¶æ˜¾ç¤ºçŠ¶æ€\n\n# 3. æˆ–è€…æ‰‹åŠ¨æ¿€æ´»\nsource venv-dev/bin/activate\n\n# 4. é€€å‡º\ndeactivate\n```\n\n### é…ç½®å‡­è¯\n\nåˆ›å»º `~/.yotta/credentials`:\n```\nuserId=<your-user-id>\napikey=<your-api-key>\n```\n\n---\n\n## ğŸš€ æµ‹è¯•æµç¨‹\n\n### 1. åŸºç¡€æµ‹è¯•\n\n```bash\n# æ¿€æ´»å¼€å‘ç¯å¢ƒ\nsource venv-dev/bin/activate\n\n# æ£€æŸ¥ Yotta æ˜¯å¦è¢«è¯†åˆ«\nsky check\n\n# æŸ¥çœ‹ Yotta GPU èµ„æº\nsky show-gpus --cloud yotta\n\n# éªŒè¯ catalog\npython3 -c \"from sky.catalog import yotta_catalog; print(yotta_catalog._df)\"\n```\n\n### 2. å¯åŠ¨ç®€å•ç¤ºä¾‹\n\nåˆ›å»º `test-yotta.yaml`:\n```yaml\nresources:\n  cloud: yotta\n  instance_type: 1x_L4_SECURE\n  \nsetup: |\n  echo \"Hello from Yotta!\"\n  nvidia-smi\n\nrun: |\n  python3 -c \"import torch; print(f'CUDA available: {torch.cuda.is_available()}')\"\n```\n\nè¿è¡Œ:\n```bash\nsky launch -c yotta-test test-yotta.yaml\n```\n\n### 3. éªŒè¯æ ¸å¿ƒåŠŸèƒ½\n\n```bash\n# æŸ¥çœ‹é›†ç¾¤çŠ¶æ€\nsky status\n\n# SSH åˆ°é›†ç¾¤\nsky ssh yotta-test\n\n# æŸ¥çœ‹æ—¥å¿—\nsky logs yotta-test\n\n# åœæ­¢é›†ç¾¤ (æ³¨æ„: Yotta ä¸æ”¯æŒ stop)\nsky down yotta-test\n```\n\n---\n\n## ğŸ“‹ æ¥å…¥ç‚¹æ€»ç»“\n\n### Yotta â†’ SkyPilot SaaS API çš„æ¥å…¥ç‚¹\n\n| æ¥å…¥ç‚¹ | æ–‡ä»¶ | åŠŸèƒ½ | API ç«¯ç‚¹ |\n|--------|------|------|----------|\n| 1. è®¤è¯ | `sky/authentication.py` | SSH å¯†é’¥æ³¨å†Œ | `POST /compute/create/publicKey` |\n| 2. åˆ›å»ºå®ä¾‹ | `sky/provision/yotta/instance.py` | Pod åˆ›å»º | `POST /compute/create` |\n| 3. æŸ¥è¯¢çŠ¶æ€ | `sky/provision/yotta/yotta_utils.py` | é›†ç¾¤æŸ¥è¯¢ | `GET /compute/list` |\n| 4. é”€æ¯å®ä¾‹ | `sky/provision/yotta/instance.py` | Pod åˆ é™¤ | `POST /compute/delete` |\n| 5. ç«¯å£æ˜ å°„ | `sky/provision/yotta/instance.py` | æŸ¥è¯¢ç«¯å£ | ä» pod metadata è·å– |\n\n### API è¯·æ±‚æ ¼å¼ç¤ºä¾‹\n\n**åˆ›å»º Pod**:\n```python\npayload = {\n    'gpu_type': 'NVIDIA_A10_24G',\n    'gpu_count': 1,\n    'image': 'yottalabsai/pytorch:2.8.0-py3.11-cuda12.8.1-cudnn-devel-ubuntu22.04-2025050802',\n    'cloud_type': CloudType.SECURE.value,\n    'disk_size': 100,\n    'timeout_seconds': timeout,\n}\nresponse = requests.post(f'{ENDPOINT}/compute/create', json=payload, headers=headers)\n```\n\n**æŸ¥è¯¢ Pods**:\n```python\nparams = {'cluster_name': cluster_name}\nresponse = requests.get(f'{ENDPOINT}/compute/list', params=params, headers=headers)\n```\n\n---\n\n## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨\n\n### Priority 1: å®Œæˆç¼ºå¤±ç»„ä»¶ âœ…\n\n1. âœ… **åˆ›å»º catalog CSV** - å·²å®Œæˆ\n2. âœ… **åˆ›å»ºå¼€å‘ç¯å¢ƒ** - å·²å®Œæˆ\n3. â³ **æ›´æ–° setup.py** - æ·»åŠ  Yotta ä¾èµ–\n\n### Priority 2: æµ‹è¯•å’ŒéªŒè¯\n\n4. **é…ç½®å‡­è¯** - åˆ›å»º `~/.yotta/credentials`\n5. **åŸºç¡€æµ‹è¯•** - `sky check`, `sky show-gpus --cloud yotta`\n6. **å¯åŠ¨æµ‹è¯•** - ä½¿ç”¨ Yotta k8s pods è¿è¡Œ `examples/minimal.yaml`\n7. **éªŒè¯åŠŸèƒ½** - SSH, ç«¯å£è½¬å‘, job æ‰§è¡Œ\n\n### Priority 3: å¢å¼ºå’Œä¼˜åŒ–\n\n8. **Multi-nodeæ”¯æŒ** - ç¡®è®¤ Yotta API æ˜¯å¦æ”¯æŒå¤šèŠ‚ç‚¹\n9. **é”™è¯¯å¤„ç†** - æ›¿æ¢å®½æ³›çš„ Exception æ•è·\n10. **æ–‡æ¡£** - æ·»åŠ ç”¨æˆ·æŒ‡å—å’Œç¤ºä¾‹\n11. **æµ‹è¯•** - ç¼–å†™å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•\n\n---\n\n## ğŸ“ å·²çŸ¥é™åˆ¶\n\n1. **ä¸æ”¯æŒ STOP**: Yotta pods ä¸èƒ½æš‚åœï¼Œåªèƒ½é”€æ¯\n2. **æ—  Spot å®ä¾‹**: ç›®å‰ä¸æ”¯æŒæŠ¢å å¼å®ä¾‹\n3. **å›ºå®šé•œåƒ**: ä½¿ç”¨é¢„å®šä¹‰çš„ Docker é•œåƒ\n4. **Launch-only ç«¯å£**: ç«¯å£åªèƒ½åœ¨å¯åŠ¨æ—¶é…ç½®\n5. **Multi-node æœªçŸ¥**: éœ€è¦ç¡®è®¤ Yotta æ˜¯å¦æ”¯æŒå¤šèŠ‚ç‚¹é›†ç¾¤\n\n---\n\n## ğŸ”— å‚è€ƒèµ„æº\n\n- **SkyPilot å®˜æ–¹æ–‡æ¡£**: https://docs.skypilot.co/en/latest/developers/index.html\n- **æ·»åŠ æ–°äº‘æŒ‡å—**: https://docs.google.com/document/d/1oWox3qb3Kz3wXXSGg9ZJWijijoa99a3PIQUHBR8UgEGs/edit\n- **å‚è€ƒå®ç°**: \n  - RunPod: `sky/clouds/runpod.py` (GPU cloud, container-based, ç±»ä¼¼ Yotta)\n  - Kubernetes: `sky/clouds/kubernetes.py` (pod-based, æ¶æ„å‚è€ƒ)\n  - Lambda: `sky/clouds/lambda_cloud.py` (GPU cloud, catalog ç¤ºä¾‹)\n\n---\n\n## ğŸ“Š è¿›åº¦è¿½è¸ª\n\n- [x] Cloud interface å®ç°\n- [x] Provisioner å®ç°\n- [x] è®¤è¯ç³»ç»Ÿé›†æˆ\n- [x] Catalog æ¨¡å—\n- [x] Ray æ¨¡æ¿é…ç½®\n- [x] Catalog CSV æ•°æ®æ–‡ä»¶\n- [x] å¼€å‘ç¯å¢ƒè®¾ç½®\n- [ ] setup.py ä¾èµ–\n- [ ] Data fetcher (å¯é€‰)\n- [ ] å•å…ƒæµ‹è¯•\n- [ ] æ–‡æ¡£å’Œç¤ºä¾‹\n- [ ] ç«¯åˆ°ç«¯æµ‹è¯•\n\n**å½“å‰å®Œæˆåº¦**: 85% â†’ 90% (å®Œæˆcatalogå’Œå¼€å‘ç¯å¢ƒ)\n\n---\n\nç”Ÿæˆæ—¶é—´: 2026-01-15  \nä½œè€…: SkyPilot Yotta Integration Team\n"
        }
    ]
}